name: Simple Windows Action

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Setup VS Dev Environment
        uses: seanmiddleditch/gha-setup-vsdevenv@v4

      - name: Disable Out of Process Building
        run: .\DisableOutOfProcBuild.exe
        working-directory: C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\IDE\CommonExtensions\Microsoft\VSI\DisableOutOfProcBuild

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2
      - name: Run a Bash script
        shell: bash
        run: |
          echo "work in progress this is going to fail, this part of the script is meant to setup the files into the proper directories"
          mkdir tools
          mkdir tools/make
          mkdir tools/cmake
          mkdir mingw
          mkdir 
          wget https://github.com/mstorsjo/llvm-mingw/releases/download/20240502/llvm-mingw-20240502-msvcrt-x86_64.zip -O llvm-mingw.zip
          wget https://gnuwin32.sourceforge.net/downlinks/make-bin-zip.php -O make-bin.zip
          wget https://gnuwin32.sourceforge.net/downlinks/make-dep-zip.php -O make-dep.zip
          wget https://github.com/Kitware/CMake/releases/download/v3.29.3/cmake-3.29.3-windows-x86_64.zip -O cmake.zip
          unzip cmake 'cmake-3.29.3-windows-x86_64/*' -d tools/cmake
          unzip make-bin -d tools/make
          unzip make-dep -d tools/make
          unzip llvm-mingw -d mingw
          echo "cleaning up..."
          rm -rf make-bin.zip
          rm -rf make-dep.zip
          rm -rf cmake.zip
          rm -rf llvm-mingw.zip
          echo "We're done here, moving on"

      - name: Build app for release
        run: DevEnv lua/lua.vdproj /build Release
